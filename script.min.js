document.addEventListener('DOMContentLoaded',()=>{const e=document.querySelector('.menu-toggle'),t=document.querySelector('.nav-links'),n=document.querySelector('.theme-toggle'),o=document.querySelector('body');e.addEventListener('click',()=>{t.classList.toggle('active')}),n.addEventListener('click',()=>{o.classList.toggle('dark-mode'),localStorage.setItem('theme',o.classList.contains('dark-mode')?'dark':'light')});const a=localStorage.getItem('theme');a&&o.classList.add('dark-mode'===a?'dark-mode':'');const i=document.querySelectorAll('.load-more');i.forEach(e=>{e.addEventListener('click',async()=>{const t=e.id.replace('loadMore',''),n=document.querySelector(`#${t}Grid`);try{const e=await fetch(`/api/${t.toLowerCase()}?offset=${n.children.length}`),o=await e.json();o.forEach(e=>{const t=document.createElement('div');t.innerHTML=e.html,n.appendChild(t)}),0===o.length&&e.setAttribute('disabled','')}catch(e){console.error(`Error loading ${t}:`,e)}})});const s=document.getElementById('contact-form');s.addEventListener('submit',async e=>{e.preventDefault();const t=new FormData(s),n=await fetch('/api/contact',{method:'POST',body:t,headers:{'CSRF-Token':document.querySelector('input[name="_csrf"]').value}});if(200===n.status){const e=document.getElementById('successMessage');e.classList.remove('hidden'),s.reset(),setTimeout(()=>{e.classList.add('hidden')},3e3)}else alert('Failed to send message')});const r=document.querySelectorAll('.like-button');r.forEach(e=>{e.addEventListener('click',async()=>{const t=e.closest('.blog-post').dataset.id;try{const n=await fetch(`/api/like/${t}`,{method:'POST',headers:{'CSRF-Token':document.querySelector('input[name="_csrf"]').value}}),o=await n.json();e.textContent=`Like (${o.likes})`}catch(e){console.error('Like error:',e)}})});const c=document.querySelectorAll('.comment-button');c.forEach(e=>{e.addEventListener('click',()=>{const t=e.nextElementSibling;t.style.display='block'===t.style.display?'none':'block'})});const l=io();l.on('updateLikes',e=>{const t=document.querySelector(`.blog-post[data-id="${e.id}"] .like-button`);t&&(t.textContent=`Like (${e.likes})`)}),l.on('newComment',e=>{const t=document.querySelector(`.blog-post[data-id="${e.postId}"] .comment-section`);if(t){const n=document.createElement('p');n.textContent=`${e.author}: ${e.text}`,t.appendChild(n)}})});
